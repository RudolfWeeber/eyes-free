<!DOCTYPE html>
<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mah√© <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
-->
<html>
<head>
  <title></title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <!--This one seems to work all the time, but really small on ipad-->
  <!--<meta name="viewport" content="initial-scale=0.4">-->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" media="all" href="theme/css/default.css">
  <link rel="stylesheet" media="all" href="theme/css/io2013.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="theme/css/phone.css">
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  <script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="logoslide nobackground">
    <article class="flexbox vcenter">
      <span><img src="images/google_developers_logo.png"></span>
    </article>
  </slide>

  <slide class="title-slide segue nobackground">
    <aside class="gdbar"><img src="images/accessibility_icon_128.png"></aside>
    <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
      <p data-config-presenter><!-- populated from slide_config.json --></p>
    </hgroup>
  </slide>

  <!-- Explain why accessibility is important (recap from I/O 2012). -->
  <slide>
    <hgroup>
      <h2>Introduction</h2>
    </hgroup>
    <article>
      <ul>
        <li>Watch <a href="http://www.youtube.com/watch?v=BPXqsPeCneA">previous</a> <a href="http://www.youtube.com/watch?v=q3HliaMjL38">talks</a> for history and deep dives on core concepts in Android accessibility</li>
        <li>Android makes it simple to deploy an application across a large number of devices</li>
        <li>Making your Android applications accessible will help reach the widest audience possible</li>
      </ul>
    </article>
  </slide>

  <!-- Basic accessibility interaction model (recap from I/O 2012). -->
  <slide>
    <hgroup>
      <h2>Accessibility services</h2>
    </hgroup>
    <article>
      <ul>
        <li>TalkBack (Froyo and above)
          <ul>
            <li>Provides spoken, auditory, and haptic feedback to blind and low-vision users</li>
            <li>Allows for random access and linear access of content</li>
          </ul>
        </li>
        <li>BrailleBack (Jelly Bean and above)
          <ul>
            <li>Allows users to access content on a refreshable braille display</li>
            <li>Supports navigation and text input from a braille keyboard</li>
          </ul>
        </li>
      </ul>
    </article>
  </slide>

  <!-- Explain the concept of accessibility focus (recap from I/O 2012). -->
  <slide>
    <hgroup>
      <h2>Accessibility focus</h2>
    </hgroup>
    <article>
    <img src="images/accessibility_focus.png" align="right" alt="Accessibility focus" title="Accessibility focus" />
      <ul>
        <li>Like input focus, but can be placed on any view</li>
        <li>Indicated visually with a yellow rectangle</li>
        <li>Assigned by TalkBack based on user interaction</li>
        <li>Indicates the active target for actions</li>
        <li>Location determined according to heuristics
          <ul>
            <li>Most fine-grained actionable view</li>
            <li>View with textual content if there is no actionable container</li>
          </ul>
        </li>
      </ul>
    </article>
  </slide>

  <!-- Example of Accessibility Focus placement -->
  <slide>
    <hgroup>
      <h2>Accessibility focus example</h2>
    </hgroup>
    <article>
      <center><img src="images/tree_view.png" alt="Accessibility focus example" title="Accessibility focus example" /></center>
    </article>
  </slide>

  <!--  -->
  <slide>
    <hgroup>
      <h2>Demo: Interacting with accessibility services</h2>
    </hgroup>
    <article>
      <ul>
        <li>TalkBack
          <ul>
            <li>Touching an item moves accessibility focus</li>
            <li>Swipe gestures move accessibility focus linearly</li>
            <li>Double-tap activates the focused item</li>
            <li>Various other directional gestures for common functions</li>
          </ul>
        </li>
        <li>BrailleBack
          <ul>
            <li>Accessibility focus moved using the keys on a refreshable braille display</li>
            <li>Click actions sent through key presses on the display</li>
            <li>Includes virtual braille overlay</li>
          </ul>
        </li>
      </ul>
    </article>
  </slide>


  <!-- Accessibility for built-in widgets (recap from I/O 2012). -->
  <slide>
    <hgroup>
      <h2>Basic application accessibility</h2>
    </hgroup>
    <article>
      <ul>
        <li>Standard framework widgets are accessible</li>
        <li>Label non-text views with content descriptions
          <ul>
            <li>Populate <code>android:contentDescription</code> for all non-text views</li>
            <li>Set <code>android:contentDescription="@null"</code> for decorative views</li>
            <li>Call <code>View.setContentDescription</code> if a view's meaning changes dynamically</li>
            <li>For controls (e.g. Switch), set <code>android:labelFor</code> to provide extra context</li>
          </ul>
        </li>
        <li>Follow W3C WAI guidelines for any web content</li>
        <li>Custom widgets almost always need extra work</li>
      </ul>
    </article>
  </slide>

  <!-- Introduce the example of a custom bar graph view. -->
  <slide>
    <hgroup>
      <h2>Example of a custom <code>BarGraphView</code></h2>
    </hgroup>
    <article>
      <img src="images/bargraphview.png" align="right" class="reflect" alt="BarGraphView" title="BarGraphView" />
      <ul>
        <li>Widget features
          <ul>
            <li>Renders an <code>int[]</code> as a bar graph</li>
            <li>Clicking on a bar highlights it</li>
          </ul>
        </li>
        <li>Implementation details
          <ul>
            <li>Extends <code>View</code></li>
            <li>Adds methods for <code>setData()</code> and <code>setTitle()</code></li>
            <li>Overrides <code>onDraw()</code> to render title, bars, and axes</li>
            <li>Overrides <code>onTouchEvent()</code> to detect clicking on bars</li>
          </ul>
        </li>
        <li><b>From an accessibility service, this view looks completely empty</b></li>
      </ul>
    </article>
  </slide>

  <slide class="segue dark nobackground">
    <aside class="gdbar"><img src="images/accessibility_icon_128.png"></aside>
    <hgroup class="auto-fadein">
      <h2>Advanced accessibility<br>using ExploreByTouchHelper</h2>
      <h3>An easy way to implement accessibility in custom views</h3>
    </hgroup>
  </slide>

  <!-- Quick recap of what information is needed by TalkBack. -->
  <slide>
    <hgroup>
      <h2>What's in a <code>View</code>?</h2>
    </hgroup>
    <article>
      <img src="images/bargraphview.png" align="right" class="reflect" alt="BarGraphView" title="BarGraphView" />
      <ul>
        <li>Dimensions and positioning</li>
        <li>Graphics and/or text</li>
        <li>User interaction model</li>
        <li>Other views?</li>
      </ul>
    </article>
  </slide>
  
  <slide>
    <hgroup>
      <h2>What's in an <code>AccessibilityNodeInfo</code>?</h2>
    </hgroup>
    <article>
      <img src="images/bargraphview.png" align="right" class="reflect" alt="BarGraphView" title="BarGraphView" />
      <ul>
        <li>Dimensions and positioning</li>
        <li>Description and/or text</li>
        <li>User interaction model</li>
        <li>Child nodes</li>
      </ul>
    </article>
  </slide>

  <!-- Explain how accessibility concepts map to existing ones. -->
  <slide>
    <hgroup>
      <h2>Introducing the <code>ExploreByTouchHelper</code></h2>
    </hgroup>
    <article>
      <ul>
        <li>Simplifies exposing a virtual view hierarchy
          <ul>
            <li>Just <b>five</b> simple abstract methods
          </ul>
        </li>
        <li>Wraps <code>AccessibilityNodeProviderCompat</code></li>
        <li>Works with screen readers, Braille, and more</li>
        <li>Backwards compatible with API 4</li>
      </ul>
    </article>
  </slide>
  
  <slide>
    <hgroup>
      <h2>Implementing an <code>ExploreByTouchHelper</code></h2>
    </hgroup>
    <article>
       <ul>
         <li>Delegate handling of certain events</li>
         <li>Implement support for Explore by Touch</li>
         <li>Expose information to accessibility services</li>
         <li>Provide support for user interaction</li>
         <li>Test, ensure feature parity</li>
       </ul>
    </article>
  </slide>

  <!-- Changes required to add an ExploreByTouchHelper to a widget. -->
  <slide>
    <hgroup>
      <h2>Delegating accessibility support</h2>
    </hgroup>
    <article>
      <pre class="prettyprint" data-lang="java">
private final BarGraphTouchHelper mBarGraphTouchHelper;

public BarGraphView(Context context, AttributeSet attrs, int defStyle) {
    ...

    mBarGraphTouchHelper = new BarGraphTouchHelper(this);
    <b>ViewCompat.setAccessibilityDelegate(this, mBarGraphTouchHelper);</b>
}

@Override
public boolean dispatchHoverEvent(MotionEvent event) {
    <b>// Dispatch hover events to accessibility first.
    if (mBarGraphTouchHelper.dispatchHoverEvent(event)) {
        return true;
    }</b>
    return super.dispatchHoverEvent(event);
}
</pre>
    </article>
  </slide>
  
  <slide>
    <hgroup>
      <h2>Implementing an <code>ExploreByTouchHelper</code></h2>
    </hgroup>
    <article>
       <ul>
         <li><s>Delegate handling of certain events</s></li>
         <li>Implement support for Explore by Touch</li>
         <li>Expose information to accessibility services</li>
         <li>Provide support for user interaction</li>
         <li>Test, ensure feature parity</li>
       </ul>
    </article>
  </slide>

  <!-- Writing a helper, part 1: mapping logical items to virtual view ids. -->
  <slide>
    <hgroup>
      <h2>Mapping logical items to virtual view ids</h2>
    </hgroup>
    <article>
      <ul>
        <li>Logical items are referenced by the framework as virtual view ids</li>
        <li>Developer must guarantee virtual view ids are
          <ul>
            <li>One-to-one</li>
            <li>Stable</li>
            <li>Non-negative</li>
          </ul>
        </li>
        <li><code>BarGraphView</code> can reuse data array indices
          <ul>
            <li>Virtual view id 0 maps to bar for data index 0</li>
          </ul>
      </ul>
    </article>
  </slide>

  <!-- Writing a helper, part 2: exposing on-screen placement of items. -->
  <slide>
    <hgroup>
      <h2>Exposing on-screen placement of items</h2>
    </hgroup>
    <article>
      <pre class="prettyprint" data-lang="java">
@Override
protected int getVirtualViewIdAt(float x, float y) {
    <b>// We already map (x,y) to bar index for hit detection for onTouchEvent().
    int index = getBarIndexAt(x, y);</b>
    if (index >= 0) {
        return index;
    }
    return ExploreByTouchHelper.INVALID_ID;
}

@Override
protected void getVisibleVirtualViewIds(List&lt;Integer&gt; virtualViewIds) {
    <b>int count = getBarCount();</b>
    for (int index = 0; index < count; index++) {
        virtualViewIds.add(index);
    }
}
</pre>
    </article>
  </slide>
  
  <slide>
    <hgroup>
      <h2>Implementing an <code>ExploreByTouchHelper</code></h2>
    </hgroup>
    <article>
       <ul>
         <li><s>Delegate handling of certain events</s></li>
         <li><s>Implement support for Explore by Touch</s></li>
         <li>Expose information to accessibility services</li>
         <li>Provide support for user interaction</li>
         <li>Test, ensure feature parity</li>
       </ul>
    </article>
  </slide>

  <!-- Writing a helper, part 3: exposing item properties (events). -->
  <slide>
    <hgroup>
      <h2>Exposing item properties</h2>
    </hgroup>
    <article>
      <pre class="prettyprint" data-lang="xml">
<b>&lt;string name="bar_desc"&gt;Bar %1$d, value %2$d&lt;/string&gt;</b>
<b>&lt;string name="bar_desc_highlight"&gt;Bar %1$d, value %2$d highlighted&lt;/string&gt;</b>
</pre>
      <pre class="prettyprint" data-lang="java">
// Speaks the index and value. Informative, but not verbose.
private CharSequence getDescriptionForIndex(int index) {
    int value = getBarValue(index);
    <b>int templateRes = ((mHighlightIndex == index) ?
            R.string.bar_desc_highlight : R.string.bar_desc);</b>
    return getContext().getString(templateRes, index, value);
}

@Override
protected void populateEventForVirtualViewId(int virtualViewId,
        AccessibilityEvent evt) {
    CharSequence desc = getDescriptionForIndex(virtualViewId);
    evt.setContentDescription(desc);
}
</pre>
    </article>
  </slide>

  <!-- Writing a helper, part 4: exposing item properties (nodes). -->
  <slide>
    <hgroup>
      <h2>Exposing item properties</h2>
    </hgroup>
    <article>
      <pre class="prettyprint" data-lang="java">
@Override
protected void populateNodeForVirtualViewId(
        int virtualViewId, AccessibilityNodeInfoCompat node) {
    // Node and event descriptions are usually identical.
    CharSequence desc = getDescriptionForIndex(virtualViewId);
    node.setContentDescription(desc);

    // Since the user can tap a bar, add the CLICK action.
    node.addAction(AccessibilityNodeInfoCompat.ACTION_CLICK);

    // Reported bounds should be consistent with onDraw().
    Rect bounds = getBoundsForIndex(virtualViewId);
    node.setBoundsInParent(bounds);
}
</pre>
    </article>
  </slide>
  
  <slide>
    <hgroup>
      <h2>Implementing an <code>ExploreByTouchHelper</code></h2>
    </hgroup>
    <article>
       <ul>
         <li><s>Delegate handling of certain events</s></li>
         <li><s>Implement support for Explore by Touch</s></li>
         <li><s>Expose information to accessibility services</s></li>
         <li>Provide support for user interaction</li>
         <li>Test, ensure feature parity</li>
       </ul>
    </article>
  </slide>

  <!-- Writing a helper, part 5: responding to actions. -->
  <slide>
    <hgroup>
      <h2>Responding to actions</h2>
    </hgroup>
    <article>
      <pre class="prettyprint" data-lang="java">
@Override
protected boolean performActionForVirtualViewId(
        int virtualViewId, int action, Bundle arguments) {
    switch (action) {
        case AccessibilityNodeInfoCompat.ACTION_CLICK:
            // Click handling should be consistent with onTouchEvent().
            onBarClicked(virtualViewId);
            return true;
    }

    // Only need to handle actions added in populateNode.
    return false;
}
</pre>
    </article>
  </slide>

  <!-- Writing a helper, part 6: sending appropriate events. -->
  <slide>
    <hgroup>
      <h2>Sending appropriate events</h2>
    </hgroup>
    <article>
      <pre class="prettyprint" data-lang="java">
public class BarGraphView extends View {
    ...

    public void onBarClicked(int index) {
        ...

        // Highlighting affects the bar description.
        mBarGraphTouchHelper.invalidateVirtualViewId(index);

        // Send a CLICKED event to ensure consistent feedback.
        mBarGraphTouchHelper.sendEventForVirtualViewId(index,
                AccessibilityEvent.TYPE_VIEW_CLICKED);
    }
}
</pre>
    </article>
  </slide>
  
  <slide>
    <hgroup>
      <h2>Implementing an <code>ExploreByTouchHelper</code></h2>
    </hgroup>
    <article>
       <ul>
         <li><s>Delegate handling of certain events</s></li>
         <li><s>Implement support for Explore by Touch</s></li>
         <li><s>Expose information to accessibility services</s></li>
         <li><s>Provide support for user interaction</s></li>
         <li>Test, ensure feature parity</li>
       </ul>
    </article>
  </slide>

  <!-- Writing a helper, part 7: providing a good user experience. -->
  <slide>
    <hgroup>
      <h2>Polishing the user experience</h2>
    </hgroup>
    <article>
      <pre class="prettyprint" data-lang="xml">
&lt;string name="bar_graph_desc"&gt;%1$s bar graph, showing %2$d bars&lt;/string&gt;
</pre>
      <pre class="prettyprint" data-lang="java">
public class BarGraphView extends View {
    ...

    public void setTitle(CharSequence title) {
        ...

        // Speaks the title and number of bars shown.
        int count = getBarCount();
        setContentDescription(getContext().getString(
                R.string.bar_graph_desc, title, count));
    }
}
</pre>
    </article>
  </slide>
  
  <slide>
    <hgroup>
      <h2>Implementing an <code>ExploreByTouchHelper</code></h2>
    </hgroup>
    <article>
       <ul>
         <li><s>Delegate handling of certain events</s></li>
         <li><s>Implement support for Explore by Touch</s></li>
         <li><s>Expose information to accessibility services</s></li>
         <li><s>Provide support for user interaction</s></li>
         <li><s>Test, ensure feature parity</s></li>
       </ul>
    </article>
  </slide>

  <!-- ExploreByTouchHelper summary slide. -->
  <slide>
    <hgroup>
      <h2>Summary of <code>ExploreByTouchHelper</code></h2>
    </hgroup>
    <article>
      <ul class="build">
        <li>Accessibility in custom views is <b>easy</b></li>
      </ul>
    </article>
  </slide>
  
  <!-- Conclusion slide. -->
  <slide>
    <hgroup>
      <h2>Conclusion</h2>
    </hgroup>
    <article>
      <ul>
        <li>Writing accessible Android applications is <b>easy</b></li>
        <li>Android has built-in accessibility support</li>
        <li>Good accessibility can increase your user base and make users happy</li>
      </ul>
    </article>
  </slide>

  <!-- Thank you slide. -->
  <slide class="thank-you-slide segue nobackground">
    <aside class="gdbar right"><img src="images/accessibility_icon_128.png"></aside>
    <article class="flexbox vleft auto-fadein">
      <h2>Thank You!</h2>
      <p>
        Source code available at <b>eyes-free.googlecode.com</b><br><br>
        For demos and more information, please stop by<br>
        the Accessibility sandbox on the second floor.
      </p>
    </article>
    <p class="auto-fadein" data-config-contact>
      <!-- populated from slide_config.json -->
    </p>
  </slide>

  <slide class="logoslide dark nobackground">
    <article class="flexbox vcenter">
      <span><img src="images/google_developers_logo.png"></span>
    </article>
  </slide>

  <slide class="backdrop"></slide>

</slides>

<script>
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-XXXXXXXX-1']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>
